# è¿”ç¤¼å“ã‚«ãƒ†ã‚´ãƒªæ©Ÿèƒ½ï¼šå¤šå¯¾å¤šã‹ã‚‰ä¸€å¯¾ä¸€ã¸ã®è¨­è¨ˆå¤‰æ›´

**å¤‰æ›´æ—¥**: 2025-01-26  
**ç†ç”±**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã¨ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§å‘ä¸Š  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¿®æ­£å®Œäº†ã€ã‚³ãƒ¼ãƒ‰ä¿®æ­£å¾…ã¡

---

## ğŸ“‹ è¨­è¨ˆå¤‰æ›´ã®èƒŒæ™¯

### å¤‰æ›´å‰ã®è¨­è¨ˆï¼ˆå¤šå¯¾å¤šï¼‰
- 1ã¤ã®å¯„ä»˜ã«è¤‡æ•°ã®ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠå¯èƒ½
- ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ« `donation_return_item_tags` ã§é–¢é€£ä»˜ã‘
- ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¤‡æ•°é¸æŠUI

### å¤‰æ›´ã®ç†ç”±

#### 1. **ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆã¨ã®æ•´åˆæ€§**
- æ¥½å¤©ãµã‚‹ã•ã¨ç´ç¨ã€ã•ã¨ãµã‚‹ã€ãµã‚‹ã•ã¨ãƒãƒ§ã‚¤ã‚¹ã¯å…¨ã¦ **1å•†å“ = 1ã‚«ãƒ†ã‚´ãƒª**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ—¢ã«ã“ã®UXã«æ…£ã‚Œã¦ã„ã‚‹
- çµ±ä¸€ã•ã‚ŒãŸUXã‚’æä¾›ã™ã¹ã

#### 2. **ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§**
- å¤šå¯¾å¤šã®å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦é¸æŠæ•°ãŒç•°ãªã‚‹
  - Aã•ã‚“ï¼šã€Œå’Œç‰›ã€â†’ ç‰›è‚‰ã®ã¿
  - Bã•ã‚“ï¼šã€Œå’Œç‰›ã€â†’ ç‰›è‚‰ + è‚‰é¡ + ç„¼è‚‰ã‚»ãƒƒãƒˆã®3ã¤
- ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ï¼ˆPhase 2ï¼‰ã§çµ±è¨ˆãŒãƒ–ãƒ¬ã‚‹
- ãƒ‡ãƒ¼ã‚¿ã®ä¿¡é ¼æ€§ãŒä½ä¸‹

#### 3. **ã‚·ãƒ³ãƒ—ãƒ«ã•**
- ãƒ•ã‚©ãƒ¼ãƒ ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹
- ã€Œã„ãã¤é¸ã¹ã°ã„ã„ã®ï¼Ÿã€ã¨ã„ã†è¿·ã„ãŒãªããªã‚‹
- å®Ÿè£…ã‚‚å˜ç´”ã«ãªã‚‹

### ã‚»ãƒƒãƒˆå•†å“ã®å¯¾å¿œ
- ã€Œç„¼è‚‰ã‚»ãƒƒãƒˆï¼ˆç‰›è‚‰+è±šè‚‰+é¶è‚‰ï¼‰ã€â†’ **ãƒ¡ã‚¤ãƒ³ã®é£Ÿæã‚’é¸æŠ**
- ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªã«ã€Œç„¼è‚‰ã‚»ãƒƒãƒˆã€ã€Œæµ·é®®ã‚»ãƒƒãƒˆã€ãªã©ã‚’ç”¨æ„

---

## ğŸ”§ å¤‰æ›´å†…å®¹

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

#### Beforeï¼ˆå¤šå¯¾å¤šï¼‰
```
donations
â”œâ”€â”€ id
â”œâ”€â”€ product_url
â””â”€â”€ return_item

donation_return_item_tagsï¼ˆä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
â”œâ”€â”€ donation_id â†’ donations.id
â””â”€â”€ subcategory_id â†’ return_item_subcategories.id
```

#### Afterï¼ˆä¸€å¯¾ä¸€ï¼‰
```
donations
â”œâ”€â”€ id
â”œâ”€â”€ product_url
â”œâ”€â”€ subcategory_id â†’ return_item_subcategories.id
â””â”€â”€ return_item
```

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«

**ãƒ•ã‚¡ã‚¤ãƒ«**: `supabase/migrations/20250124000002_add_return_item_categorization.sql`

**ä¸»ãªå¤‰æ›´ç‚¹**:
- âŒ `donation_return_item_tags` ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤
- âœ… `donations.subcategory_id` ã‚«ãƒ©ãƒ è¿½åŠ ï¼ˆINTEGER, FOREIGN KEYï¼‰
- âœ… ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ï¼ˆ`idx_donations_subcategory_id`ï¼‰
- âœ… ã‚«ãƒ†ã‚´ãƒªãƒã‚¹ã‚¿ï¼ˆ14ä»¶ï¼‰+ ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªãƒã‚¹ã‚¿ï¼ˆ95ä»¶ï¼‰ã¯å¤‰æ›´ãªã—

**å‰Šé™¤ã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
- ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆï¼ˆæ—§: 56-72è¡Œï¼‰
- ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSãƒãƒªã‚·ãƒ¼ï¼ˆæ—§: 304-337è¡Œï¼‰

**è¿½åŠ ã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
```sql
-- donations.subcategory_idã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
IF NOT EXISTS (
  SELECT 1 FROM information_schema.columns
  WHERE table_name = 'donations' AND column_name = 'subcategory_id'
) THEN
  ALTER TABLE donations ADD COLUMN subcategory_id INTEGER REFERENCES return_item_subcategories(id);
  COMMENT ON COLUMN donations.subcategory_id IS 'è¿”ç¤¼å“ã®ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªID';
END IF;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX IF NOT EXISTS idx_donations_subcategory_id ON donations(subcategory_id);
```

---

## ğŸ“‚ å‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

1. **`supabase/migrations/20250125000001_add_donation_url.sql`**
   - `donation_url` ã‚«ãƒ©ãƒ ã¯ä¸è¦ï¼ˆ`product_url` ã®ã¿ä½¿ç”¨ï¼‰
   - å‰Šé™¤æ¸ˆã¿

---

## ğŸ”„ devç’°å¢ƒã§ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—SQLå®Ÿè¡Œ

**Supabase Dashboardï¼ˆdevç’°å¢ƒï¼‰** â†’ SQL Editor:

```sql
-- ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤
DROP TABLE IF EXISTS donation_return_item_tags CASCADE;

-- donations.product_urlã‚«ãƒ©ãƒ ã‚’å‰Šé™¤ï¼ˆå†ä½œæˆï¼‰
ALTER TABLE donations DROP COLUMN IF EXISTS product_url;

-- donations.subcategory_idã‚«ãƒ©ãƒ ã‚’å‰Šé™¤ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
ALTER TABLE donations DROP COLUMN IF EXISTS subcategory_id;
```

### ã‚¹ãƒ†ãƒƒãƒ—2: æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

åŒã˜SQL Editorã§ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’å®Ÿè¡Œï¼š
```
supabase/migrations/20250124000002_add_return_item_categorization.sql
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ç¢ºèª

Table Editorã§ç¢ºèªï¼š
- âŒ `donation_return_item_tags` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹
- âœ… `donations.subcategory_id` ã‚«ãƒ©ãƒ ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹
- âœ… `donations.product_url` ã‚«ãƒ©ãƒ ãŒã‚ã‚‹

---

## ğŸ“ ä»Šå¾Œã®å®Ÿè£…ä½œæ¥­ï¼ˆæœªå®Œäº†ï¼‰

### 1. TypeScriptå‹å®šç¾©æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/types/database.types.ts`

**å‰Šé™¤**:
```typescript
export type DonationReturnItemTag = Tables<'donation_return_item_tags'>;
export type DonationWithCategories = Donation & { ... };
```

**è¿½åŠ **:
```typescript
donations: {
  Row: {
    // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    subcategory_id: number | null;
  };
  Insert: {
    // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    subcategory_id?: number | null;
  };
  Update: {
    // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    subcategory_id?: number | null;
  };
}
```

---

### 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/lib/validations/donations.ts`

**å¤‰æ›´å‰**:
```typescript
export const subcategoryIdsSchema = z
  .array(z.number().int().positive())
  .min(1, "å°‘ãªãã¨ã‚‚1ã¤ã®ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„")
  .max(10, "ã‚«ãƒ†ã‚´ãƒªã¯æœ€å¤§10å€‹ã¾ã§é¸æŠã§ãã¾ã™")
  .optional();
```

**å¤‰æ›´å¾Œ**:
```typescript
export const subcategoryIdSchema = z
  .number({ message: "ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„" })
  .int()
  .positive()
  .nullable()
  .optional();
```

**ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°**:
```typescript
export const createDonationSchema = z.object({
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  productUrl: productUrlSchema,
  subcategoryId: subcategoryIdSchema,  // å¤‰æ›´
});
```

---

### 3. DonationFormæ›´æ–°ï¼ˆæ–°è¦ç™»éŒ²ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/donations/DonationForm.tsx`

**UIå¤‰æ›´**:
- âŒ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¤‡æ•°é¸æŠ
- âœ… Selectã§å˜ä¸€é¸æŠ

**å‰Šé™¤**:
```typescript
const [selectedSubcategories, setSelectedSubcategories] = useState<number[]>([]);
```

**è¿½åŠ **:
```typescript
const [selectedSubcategoryId, setSelectedSubcategoryId] = useState<string>("");
```

**ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡**:
```typescript
// å¤‰æ›´å‰
selectedSubcategories.forEach((subcatId) => {
  formData.append("subcategoryIds", subcatId.toString());
});

// å¤‰æ›´å¾Œ
formData.append("subcategoryId", selectedSubcategoryId);
```

**UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
```tsx
<Select
  value={selectedSubcategoryId}
  onValueChange={setSelectedSubcategoryId}
>
  <SelectTrigger>
    <SelectValue placeholder="ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ" />
  </SelectTrigger>
  <SelectContent>
    {availableSubcategories.map((subcat) => (
      <SelectItem key={subcat.id} value={subcat.id.toString()}>
        {subcat.name}
      </SelectItem>
    ))}
  </SelectContent>
</Select>
```

---

### 4. DonationEditFormæ›´æ–°ï¼ˆç·¨é›†ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/donations/DonationEditForm.tsx`

**å¤‰æ›´å†…å®¹**:
- `existingSubcategoryIds` ãƒ—ãƒ­ãƒƒãƒ— â†’ `existingSubcategoryId` ãƒ—ãƒ­ãƒƒãƒ—
- è¤‡æ•°é¸æŠ â†’ å˜ä¸€é¸æŠ
- åˆæœŸå€¤ã®è¨­å®šæ–¹æ³•ã‚’å¤‰æ›´

**Before**:
```typescript
type DonationEditFormProps = {
  donation: Donation;
  existingSubcategoryIds?: number[];
};
```

**After**:
```typescript
type DonationEditFormProps = {
  donation: Donation;
  existingSubcategoryId?: number | null;
};
```

---

### 5. Server Actionsæ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/actions/donations.ts`

#### createDonation

**å¤‰æ›´å‰**:
```typescript
const subcategoryIds = formData.getAll("subcategoryIds")
  .map(id => parseInt(id as string))
  .filter(id => !isNaN(id));

// å¯„ä»˜ä½œæˆå¾Œ
const tags = validatedSubcategoryIds.map(subcategoryId => ({
  donation_id: insertedDonation.id,
  subcategory_id: subcategoryId,
}));
await supabase.from("donation_return_item_tags").insert(tags);
```

**å¤‰æ›´å¾Œ**:
```typescript
const subcategoryId = formData.get("subcategoryId") as string | null;
const parsedSubcategoryId = subcategoryId ? parseInt(subcategoryId) : null;

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const validationResult = createDonationSchema.safeParse({
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  subcategoryId: parsedSubcategoryId,
});

// å¯„ä»˜ä½œæˆæ™‚
const newDonation: DonationInsert = {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  subcategory_id: validatedData.subcategoryId,
};

await supabase.from("donations").insert(newDonation);
// ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®insertã¯ä¸è¦
```

#### updateDonation

**å¤‰æ›´å‰**:
```typescript
// æ—¢å­˜ã®ã‚¿ã‚°ã‚’å‰Šé™¤
await supabase.from("donation_return_item_tags").delete().eq("donation_id", id);

// æ–°ã—ã„ã‚¿ã‚°ã‚’æŒ¿å…¥
const tags = validatedSubcategoryIds.map(...);
await supabase.from("donation_return_item_tags").insert(tags);
```

**å¤‰æ›´å¾Œ**:
```typescript
const updateData: DonationUpdate = {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  subcategory_id: validatedData.subcategoryId,
};

await supabase.from("donations").update(updateData).eq("id", id);
// ã‚¿ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ“ä½œã¯ä¸è¦
```

---

### 6. DonationListæ›´æ–°ï¼ˆä¸€è¦§è¡¨ç¤ºï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/donations/DonationList.tsx`

**ãƒ‡ãƒ¼ã‚¿å–å¾—ã®å¤‰æ›´**:

**å¤‰æ›´å‰**:
```typescript
.select(`
  *,
  donation_return_item_tags (
    subcategory_id,
    return_item_subcategories (
      id, name, slug, category_id,
      return_item_categories (
        id, name, slug
      )
    )
  )
`)
```

**å¤‰æ›´å¾Œ**:
```typescript
.select(`
  *,
  return_item_subcategories (
    id,
    name,
    slug,
    return_item_categories (
      id,
      name,
      slug
    )
  )
`)
```

**å‹å®šç¾©ã®å¤‰æ›´**:

**å¤‰æ›´å‰**:
```typescript
type DonationWithCategories = Donation & {
  donation_return_item_tags?: Array<{...}>;
};
```

**å¤‰æ›´å¾Œ**:
```typescript
type DonationWithCategory = Donation & {
  return_item_subcategories?: {
    id: number;
    name: string;
    slug: string;
    return_item_categories: {
      id: number;
      name: string;
      slug: string;
    } | null;
  } | null;
};
```

**è¡¨ç¤ºã®å¤‰æ›´**:

**å¤‰æ›´å‰**:
```tsx
{donation.donation_return_item_tags?.map((tag) => (
  <Badge key={tag.subcategory_id}>
    {tag.return_item_subcategories?.name}
  </Badge>
))}
```

**å¤‰æ›´å¾Œ**:
```tsx
{donation.return_item_subcategories && (
  <Badge>
    {donation.return_item_subcategories.name}
  </Badge>
)}
```

---

### 7. ãƒ‡ãƒ¼ã‚¿å–å¾—å´ã®æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/app/dashboard/donations/page.tsx`

**ã‚¯ã‚¨ãƒªã®å¤‰æ›´**:
```typescript
const { data: donations } = await supabase
  .from("donations")
  .select(`
    *,
    return_item_subcategories (
      id,
      name,
      slug,
      return_item_categories (
        id,
        name,
        slug
      )
    )
  `)
  .eq("user_id", user.id)
  .order("donation_date", { ascending: false });
```

---

## âœ… å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯

- [x] è¨­è¨ˆå¤‰æ›´ã®æ±ºå®šï¼ˆå¤šå¯¾å¤š â†’ ä¸€å¯¾ä¸€ï¼‰
- [x] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£
- [x] ä¸è¦ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
- [x] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—SQLã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

---

## â³ æ®‹ã‚Šã®ã‚¿ã‚¹ã‚¯

- [ ] devç’°å¢ƒã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—SQLå®Ÿè¡Œ
- [ ] devç’°å¢ƒã§æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- [ ] TypeScriptå‹å®šç¾©æ›´æ–°
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒæ›´æ–°
- [ ] DonationFormæ›´æ–°ï¼ˆå˜ä¸€é¸æŠUIï¼‰
- [ ] DonationEditFormæ›´æ–°
- [ ] Server Actionsæ›´æ–°ï¼ˆcreate/updateï¼‰
- [ ] DonationListæ›´æ–°ï¼ˆã‚«ãƒ†ã‚´ãƒªè¡¨ç¤ºï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¯ã‚¨ãƒªæ›´æ–°
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ç¢ºèª
- [ ] devç’°å¢ƒã§å‹•ä½œç¢ºèª
- [ ] prdç’°å¢ƒã¸ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### Beforeï¼ˆå¤šå¯¾å¤šï¼‰
- âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿·ã†ï¼ˆã„ãã¤é¸ã¹ã°ã„ã„ï¼Ÿï¼‰
- âŒ äººã«ã‚ˆã£ã¦é¸ã³æ–¹ãŒç•°ãªã‚‹
- âŒ çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ç¢º
- âŒ è¤‡é›‘ãªå®Ÿè£…

### Afterï¼ˆä¸€å¯¾ä¸€ï¼‰
- âœ… ã‚·ãƒ³ãƒ—ãƒ«ã§è¿·ã‚ãªã„
- âœ… å…¨å“¡ãŒåŒã˜åŸºæº–ã§é¸æŠ
- âœ… çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒæ­£ç¢º
- âœ… ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆã¨åŒã˜UX
- âœ… å®Ÿè£…ãŒå˜ç´”

---

## ğŸ” æ³¨æ„ç‚¹

### ã‚»ãƒƒãƒˆå•†å“ã®æ‰±ã„
- ã€Œç„¼è‚‰ã‚»ãƒƒãƒˆï¼ˆç‰›è‚‰+è±šè‚‰+é¶è‚‰ï¼‰ã€ã®å ´åˆ
  - â†’ ã€Œç„¼è‚‰ã‚»ãƒƒãƒˆã€ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠï¼ˆè‚‰é¡ > ç„¼è‚‰ã‚»ãƒƒãƒˆï¼‰
  - ã¾ãŸã¯ã€Œç‰›è‚‰ã€ãªã©ãƒ¡ã‚¤ãƒ³ã®é£Ÿæã‚’é¸æŠ
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç”±ã«ä»»ã›ã‚‹

### æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¸ã®å½±éŸ¿
- æ—¢å­˜ã®å¯„ä»˜ãƒ‡ãƒ¼ã‚¿ã«ã¯ `subcategory_id` ãŒ NULL
- ç·¨é›†æ™‚ã«é¸æŠã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
- å¿…é ˆå…¥åŠ›ã«ã¯ã—ãªã„ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

---

**æœ€çµ‚æ›´æ–°**: 2025-01-26  
**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: devç’°å¢ƒã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†å®Ÿè¡Œå¾Œã€ã‚³ãƒ¼ãƒ‰ä¿®æ­£ã«ç€æ‰‹
